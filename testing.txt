//version 1.1 - updated with new syntax and optimized for RoomOS 11

import 
);

xapi.Status.Conference.Presentation.Mode.on(presentationStatus =>{
  if (presentationStatus === 'Off' || presentationStatus === 'Receiving'){
    xapi.Command.UserInterface.Extensions.Widget.UnsetValue({ WidgetId: 'presentation_source' });
  }
});

xapi.Status.Standby.State.on(standbyState => {
  if (standbyState === "Off"){
    StopPresentation();
}});

StopPresentation();


function createPanel(id, name) {
  const panel = `
  <Extensions>
  <Version>1.11</Version>
  <Panel>
    <Order>2</Order>
    <PanelId>mcs_panel</PanelId>
    <Origin>local</Origin>
    <Location>HomeScreenAndCallControls</Location>
    <Icon>Laptop</Icon>
    <Color>#262626</Color>
    <Name>Offline Screen Sharing</Name>
    <ActivityType>Custom</ActivityType>
    <Page>
      <Name>Select content to share</Name>
      <Row>
        <Name> </Name>
        <Widget>
          <WidgetId>presentation_source</WidgetId>
          <Type>GroupButton</Type>
          <Options>size=4;columns=1</Options>
          <ValueSpace>
            <Value>
              <Key>pc_2</Key>
              <Name>USB-C</Name>
            </Value>
            <Value>
              <Key>pc_1</Key>
              <Name>HDMI</Name>
            </Value>
            <Value>
              <Key>2_sources</Key>
              <Name>USB + HDMI</Name>
            </Value>
          </ValueSpace>
        </Widget>
      </Row>
      <Row>
        <Name> </Name>
        <Widget>
          <WidgetId>presentation_stop</WidgetId>
          <Name>Remove presentation</Name>
          <Type>Button</Type>
          <Options>size=4</Options>
        </Widget>
      </Row>
      <Options>hideRowNames=1</Options>
    </Page>
  </Panel>
</Extensions>

 `;

  xapi.Command.UserInterface.Extensions.Panel.Save(
    {PanelId: id},
    panel
  );
} 

createPanel("mcs_panel", "Share screen");